<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>神奇的游戏</title>
  <link href="game.css" rel="stylesheet" type="text/css">
  <script type="text/javascript" src="js/jquery-2.0.3.min.js"></script>
  <script type="text/javascript" src="game.js"></script>
  <script type="text/javascript" src="gameContent.js"></script>
</head>

<body>
<div id="mainF" class="main"></div>
<div id="msg" class="Word">Loading...</div>
<div id="mainB" class="main"></div>
<div id="cam">
  <div style="position: absolute; z-index:-10000;">
    <div id="example" style="width: 470px; height: 300px;"><div class="photobooth" style="width: 470px; height: 300px;"><div class="blind anim" style="opacity: 0; display:none;"></div><canvas width="470" height="300"></canvas><div class="warning notSupported">Sorry, Photobooth.js is not supported by your browser</div><div class="warning noWebcam" style="display: none;">Please give Photobooth permission to use your Webcam. <span>Try again</span></div><ul><li title="hue" class="hue"><div class="submenu"><div class="tip"></div><div class="slider"><div class="track"></div><div class="handle" style="left:50px"><div></div></div></div></div></li><li title="saturation" class="saturation"><div class="submenu"><div class="tip"></div><div class="slider"><div class="track"></div><div class="handle" style="left:50px"><div></div></div></div></div></li><li title="brightness" class="brightness"><div class="submenu"><div class="tip"></div><div class="slider"><div class="track"></div><div class="handle" style="left:50px"><div></div></div></div></div></li><li title="crop" class="crop"></li><li title="take picture" class="trigger"></li></ul><div class="resizehandle"><div class="handle"><div></div></div></div></div></div>
    <div style="width: 470px; height: 30px;">
      <form>
        <input type="button" onclick="" value="Slowly Press Me Two Times ">
      </form>
    </div>
    <div id="game_div" style="overflow: hidden;"> <canvas width="400" height="490" style="display: block; touch-action: none; -webkit-user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></canvas></div>
  </div>

  <pre id="response" style="position: absolute; z-index:10000; display: none;">Loading...</pre>
</div>

<script type="text/javascript" src="./Express_files/av-mini-0.5.4.js"></script>
<script type="text/javascript" src="./Express_files/facepp-sdk.min.js"></script>
<script type="text/javascript" src="./Express_files/photobooth_min.js"></script>
<script type="text/javascript" src="./Express_files/base64.js"></script>
<script type="text/javascript" src="./Express_files/phaser.min.js"></script>

<script type="text/javascript">
  AV.initialize("0wuecmgwc7sg9r1np1eux3yya7lq4k7qenlpmp0qnmsnx3jm", "e65f7h0t6atg0vx1sv2pzpfz671s9ldy0r44w2ig2dgc7ir1");
  container = document.getElementById( "example" );
  myPhotobooth = new Photobooth( container );
  function si() {
    $('.trigger').click();
    myPhotobooth.onImage = function (dataUrl) {
      var dataString = dataUrl.split(",")[1];
      var extension = dataUrl.match(/\/(.*)\;/)[1];
      var avFile = new AV.File("image." + extension, { base64: dataString });

      avFile.save().then(function () {
        imgUrl = avFile.url();
        console.log(imgUrl);
        var api = new FacePP('03185d23e0c06c266049f9c6c024dd6a', 'tkDEWxFl7jl9v0ky6g3m2OtGn5KFG0Az');
        api.request('detection/detect', {
          url: imgUrl
        }, function (err, result) {
          if (err) {
            // TODO handle error
          }
          // TODO use result
          document.getElementById('response').innerHTML = JSON.stringify(result);
          window.FaceData = result;

        });
      });
    }
  }

  setInterval(si, 1000);
</script>
</body>
</html>
